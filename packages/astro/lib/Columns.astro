---
import { getBreakpointValue, uid } from '@chisel-ui/core'
import './Columns.css'
import Layout from './Layout.astro'
import type { Breakpoint, Theme } from '@chisel-ui/core'
import type { Props as LayoutProps } from './Layout.astro'

export interface Props<T extends Theme = Theme> extends LayoutProps<T> {
	columns?: number
	dense?: boolean
	switchAt?: Breakpoint<T['breakpoints']>
}

const {
	theme = {},
	id = uid(),
	columns = 1,
	dense = false,
	switchAt = '0px',
	...props
} = Astro.props as Props

const safeColumns = columns ?? 1
const safeBreakpoint = getBreakpointValue(theme, switchAt)

const inlineStyle = `
    @media (min-width: ${safeBreakpoint}) {
        #${id} {
            --columns: ${safeColumns};
        }
    }
`
---

<Layout data-chisel-columns={dense ? 'dense' : ''} {id} {theme} {...props}>
	<slot />
</Layout>

<style set:html={inlineStyle}></style>